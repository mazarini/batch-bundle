#!/bin/bash

echo "ğŸ” Running pre-commit checks..."

# Detect OS and set composer command
if [[ "$OSTYPE" == "msys" || "$OSTYPE" == "win32" ]]; then
    COMPOSER="composer.bat"
else
    COMPOSER="composer"
fi

# Validate
echo "âœ… Running validate strict..."
$COMPOSER validate --strict
if [ $? -ne 0 ]; then
    echo "âŒ Validation failed!"
    exit 1
fi

# PHP CS Fixer
echo "ğŸ¨ Running PHP CS Fixer..."
$COMPOSER lint
if [ $? -ne 0 ]; then
    echo "âŒ Code style issues found!"
    exit 1
fi

# PHPStan
echo "ğŸ”¬ Running PHPStan..."
$COMPOSER phpstan
if [ $? -ne 0 ]; then
    echo "âŒ PHPStan errors found!"
    exit 1
fi

echo "âœ… All checks passed!"
